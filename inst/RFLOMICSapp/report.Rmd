---
title: "`r params$title`"
author: "Analysis were performed by the RFLOMICS package (cite)"
date: "The `r format(Sys.time(), '%d %B, %Y')`"
bibliography: bibliography.bib
output: 
  html_document:
    df_print: paged
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: true
      smooth_scroll: true
    number_sections: true
    theme: united
params: 
  outDir: NA
  FEdata: NA
  title: NA
---


```{r , include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = FALSE, error = TRUE)
options(knitr.duplicate.label = "allow")
```

```{r library}

library(RFLOMICS)
```


```{r parameters, include=FALSE}

load(params$FEdata)
outDir <- params$outDir
projectName <- params$title
```

```{r , message=FALSE, warning=FALSE, echo=FALSE}
# Create a directory to store all the results (tables and figures) of the project in a tmpdir
# user may download this results as an archive from the shiny interface
dir.create(path = outDir, showWarnings = FALSE)
```

<!-- enable to zoom by clicking on graphs in the report -->

```{css zoom-lib-src}
### ZOOM 
script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"
```

```{js zoom-jquery}
$(document).ready(function() {
$('body').prepend('<div class=\"zoomDiv\"><img src=\"\" class=\"zoomImg\"></div>');
// onClick function for all plots (img's)
$('img:not(.zoomImg)').click(function() {
$('.zoomImg').attr('src', $(this).attr('src')).css({width: '100%'});
$('.zoomDiv').css({opacity: '1', width: 'auto', border: '1px solid white', borderRadius: '5px', position: 'fixed', top: '50%', left: '50%', marginRight: '-50%', transform: 'translate(-50%, -50%)', boxShadow: '0px 0px 50px #888888', zIndex: '50', overflow: 'auto', maxHeight: '100%'});
});
// onClick function for zoomImg
$('img.zoomImg').click(function() {
$('.zoomDiv').css({opacity: '0', width: '0%'}); 
});
});
```



<!-- Experimental design -->

```{r}

out <- NULL

out <- c(out, knitr::knit_child(paste0(path.package("RFLOMICS"), "/RFLOMICSapp/","report_02_design.Rmd"), quiet=TRUE))  

knitr::asis_output(out)

```

<!-- single omics analysis -->

```{r analysis, eval=(length(getOmicsTypes(rflomics.MAE)) != 0 )}

out <- NULL
omicsData <- getOmicsTypes(rflomics.MAE)
for (omictype in unique(omicsData)){ 
  
  for (data in  names(omicsData[omicsData == omictype])){
    
    child <- paste0(path.package("RFLOMICS"), "/RFLOMICSapp/","report_01_omics.Rmd") 
    out   <- c(out, knitr::knit_child(child, quiet=TRUE))  
  }
}

knitr::asis_output(out)

```

<!-- data integration  -->

<!-- ## with MOFA -->

`r if(is.null(rflomics.MAE@metadata$IntegrationAnalysis$MOFA)) {"\\begin{comment}"}`

# MOFA2 Integration

`r if(is.null(rflomics.MAE@metadata$IntegrationAnalysis$MOFA)) {"\\end{comment}"}`

```{r, eval = !is.null(rflomics.MAE@metadata$IntegrationAnalysis$MOFA), hide = is.null(rflomics.MAE@metadata$IntegrationAnalysis$MOFA) }

out <- NULL

out <- c(out, knitr::knit_child(paste0(path.package("RFLOMICS"), "/RFLOMICSapp/","report_07_MOFA2_integration.Rmd"), quiet=TRUE))

knitr::asis_output(out)

```

<!-- ## with MixOmix -->

`r if(is.null(rflomics.MAE@metadata$IntegrationAnalysis$mixOmics)) {"\\begin{comment}"}`

# MixOmics Integration

`r if(is.null(rflomics.MAE@metadata$IntegrationAnalysis$mixOmics)) {"\\end{comment}"}`

```{r, eval = !is.null(rflomics.MAE@metadata$IntegrationAnalysis$mixOmics), hide = is.null(rflomics.MAE@metadata$IntegrationAnalysis$mixOmics) }

out <- NULL
for (selectedResponse in names(rflomics.MAE@metadata$IntegrationAnalysis$mixOmics)) { 
  
  child <-  paste0(path.package("RFLOMICS"), "/RFLOMICSapp/","report_08_mixOmics_integration.Rmd") 
  
  out <- c(out, knitr::knit_child(child, quiet = TRUE))  
}

knitr::asis_output(out)

```

# R Session

See **session_info.txt** files in the results directory.

```{r session, message=FALSE, warning=FALSE, echo=FALSE, echo=FALSE}
writeLines(capture.output(devtools::session_info()),  paste0(outDir,"/","session_info.txt"))
```


# Bibliographie

<div id="refs"></div>


