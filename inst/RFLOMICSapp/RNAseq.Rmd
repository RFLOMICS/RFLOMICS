

# `r data`  analysis

## data Exploratory

> raw data 

```{r , echo=FALSE, message=TRUE, warning=TRUE}
#data <- paste0("RNAseq.",data)

colnames(assay(FlomicsMultiAssay[[data]]))

```


> Library size

```{r, fig.show = "hold", out.width = "50%", message=FALSE, warning=FALSE, echo=FALSE}
#knitr::include_graphics(c(file.path(pngDir, paste0(data, "_LibSize.png")), 
#                          file.path(pngDir, paste0(data, "_CountDist.png"))))

plotLibSize(abundances= assay(FlomicsMultiAssay[[data]]), 
            dataName  = data, 
            pngFile   = NULL)

```

> Count distribution

```{r,echo=FALSE, fig.show = "hold", out.width = "50%", message=FALSE, warning=FALSE}
#knitr::include_graphics(c(file.path(pngDir, paste0(data, "_LibSize.png")), 
#                          file.path(pngDir, paste0(data, "_CountDist.png"))))

plotDistr(abundances= assay(FlomicsMultiAssay[[data]]),
          dataName  = data, 
          pngFile   = NULL)
```

> Principal component analysis


```{r ,  message=FALSE, warning=FALSE, fig.show = "hold", out.width = "50%"}
knitr::include_graphics(list.files (path = file.path(pngDir), 
                                    pattern = paste0(data,"_PCAdesign_raw_PC"), 
                                    full.names = TRUE))
```


```{r ,  fig.show="hold", message=FALSE, warning=FALSE, cho=FALSE}
#, paged.print=FALSE
#knitr::include_graphics(file.path(pngDir, paste0(data, "_PCAdesignCoordRaw.png")))
mvQCdesign(object = FlomicsMultiAssay,
           data   = data, PCA="raw", axis=5, 
           pngFile= NULL) 
```


```{r , echo=FALSE,message=FALSE, warning=FALSE, fig.show = "hold"}

#knitr::include_graphics(file.path(pngDir, paste0(data, "_PCAmetaCorrRaw.png")))
# mvQCdata(object = FlomicsMultiAssay,
#          data   = data, PCA="raw", axis=5, 
#          pngFile= NULL) 

```

## Filtering and Normalisation

> Normalisation method : `r FlomicsMultiAssay[[paste0(data, ".filtred")]]@metadata$Normalization$methode`

```{r ,echo=FALSE,message=FALSE, warning=FALSE,  fig.show = "hold"}
#knitr::include_graphics(file.path(pngDir, paste0(data, "_norm.boxplot.png")))
abundanceBoxplot(object  = FlomicsMultiAssay, 
                 dataType= paste0(data,".filtred"), 
                 pngFile = NULL)

```


```{r , echo=FALSE,message=FALSE, warning=FALSE,  fig.show = "hold", out.width = "50%"}
knitr::include_graphics(list.files (path = file.path(pngDir), 
                                    pattern = paste0(data,"_PCAdesign_norm_PC"), 
                                    full.names = TRUE))

```

## Differential expression analysis 

```{r ,echo=FALSE,message=FALSE, warning=FALSE,  fig.show = "hold", out.width = "50%"}
#knitr::include_graphics(list.files (path = file.path(pngDir), 
#                                    pattern = paste0(data, "_PvalueDistribution"), 
#                                    full.names = TRUE))

for (contrast  in  names(FlomicsMultiAssay@ExperimentList[[paste0(data,".filtred")]]@metadata[["AnaDiffDeg"]])) {
    
   print(paste("#", contrast))
  
   #print(FlomicsMultiAssay@ExperimentList[[paste0(data,".filtred")]]@metadata[["AnaDiffDeg"]][[contrast]] %>% knitr::kable())
  
   p <- pvalue.plot(data    = FlomicsMultiAssay@ExperimentList[[paste0(data,".filtred")]]@metadata[["AnaDiffDeg"]][[contrast]], 
               contrast= as.vector(filter(FlomicsMultiAssay@metadata$design@Contrasts.List , idContrast == contrast)$hypoth),
               pngFile = NULL) 
   print(p)
}


```
